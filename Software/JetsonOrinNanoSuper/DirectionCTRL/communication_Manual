ì£¼ìš” ê¸°ëŠ¥
1. ì–‘ë°©í–¥ í†µì‹ 

ë“œë¡  â†’ Jetson: GPS ë° í…”ë ˆë©”íŠ¸ë¦¬ ë°ì´í„° ì „ì†¡
Jetson â†’ ë“œë¡ : ì œì–´ ëª…ë ¹ ë° GPS ì´ë™ ëª…ë ¹ ì „ì†¡

2. ë©”ì‹œì§€ íƒ€ì…

GPS_DATA: GPS/í…”ë ˆë©”íŠ¸ë¦¬ ë°ì´í„°
CONTROL_CMD: ì¼ë°˜ ì œì–´ ëª…ë ¹
GPS_CMD: GPS ì¢Œí‘œ ì´ë™ ëª…ë ¹
ACK: ëª…ë ¹ ìˆ˜ì‹  í™•ì¸
STATUS: ë“œë¡  ìƒíƒœ
HEARTBEAT: ì—°ê²° ìƒíƒœ í™•ì¸

3. ë‘ ê°€ì§€ ì¸í„°í˜ì´ìŠ¤

UARTCommunication: ë“œë¡  ì¸¡ì—ì„œ ì‚¬ìš©
JetsonInterface: Jetson ì¸¡ì—ì„œ ì‚¬ìš©

ğŸš€ ì‚¬ìš© ë°©ë²•
ë“œë¡  ì¸¡ (main_control.pyì—ì„œ)
pythonfrom communication import UARTCommunication

# ì´ˆê¸°í™”
uart = UARTCommunication("/dev/ttyTHS1", 115200)
uart.start()

# GPS ë°ì´í„° ì „ì†¡
telemetry = await connection.get_telemetry()
uart.send_gps_data(telemetry)

# ì œì–´ ëª…ë ¹ ìˆ˜ì‹ 
cmd = uart.get_control_command()
if cmd:
    command_data = cmd.get('command', {})
    drone.cmd = [
        command_data.get('vertical'),
        command_data.get('horizontal'),
        command_data.get('rotation'),
        command_data.get('speed')
    ]

# GPS ëª…ë ¹ ìˆ˜ì‹ 
gps_cmd = uart.get_gps_command()
if gps_cmd:
    gps_data = gps_cmd.get('command', {})
    drone.cmd = [
        "gps",
        gps_data.get('latitude'),
        gps_data.get('longitude'),
        gps_data.get('altitude', 10.0)
    ]
Jetson ì¸¡ (ì™¸ë¶€ ëª¨ë“ˆì—ì„œ)
pythonfrom communication import JetsonInterface

# ì—°ê²°
jetson = JetsonInterface("/dev/ttyTHS1", 115200)
jetson.connect()

# ì¼ë°˜ ì œì–´ ëª…ë ¹
jetson.send_control(["up", "forward_left", 30, 50])

# GPS ì´ë™ ëª…ë ¹
jetson.send_control(["gps", 35.123456, 129.123456, 10.0])

# GPS ë°ì´í„° ìˆ˜ì‹ 
gps_data = jetson.get_gps_data()
if gps_data:
    print(f"ë“œë¡  ìœ„ì¹˜: {gps_data['position']}")
    print(f"ë°°í„°ë¦¬: {gps_data['battery']}")
ğŸ“Š í†µì‹  í”„ë¡œí† ì½œ
ì œì–´ ëª…ë ¹ (Jetson â†’ ë“œë¡ )
json{
    "type": "CTRL",
    "seq": 123,
    "timestamp": "2025-01-15T10:30:00",
    "command": {
        "vertical": "up",
        "horizontal": "forward_left",
        "rotation": 30,
        "speed": 50,
        "speed_type": "percent"
    }
}
GPS ëª…ë ¹ (Jetson â†’ ë“œë¡ )
json{
    "type": "GPS_CMD",
    "seq": 124,
    "timestamp": "2025-01-15T10:31:00",
    "command": {
        "latitude": 35.123456,
        "longitude": 129.123456,
        "altitude": 10.0
    }
}
GPS ë°ì´í„° (ë“œë¡  â†’ Jetson)
json{
    "type": "GPS",
    "timestamp": "2025-01-15T10:30:00",
    "data": {
        "position": {
            "lat": 35.123456,
            "lon": 129.123456,
            "alt_rel": 10.0
        },
        "velocity": {
            "north": 1.2,
            "east": 0.5,
            "down": -0.1
        },
        "battery": {
            "voltage": 12.4,
            "percent": 85
        }
    }
}
ğŸ”§ í†µí•© ì˜ˆì œ
python# main_control.pyì—ì„œ ì‚¬ìš©
class Drone:
    def __init__(self):
        self.uart = UARTCommunication("/dev/ttyTHS1", 115200)
        
    async def _uart_processing_loop(self):
        """UART ëª…ë ¹ ì²˜ë¦¬"""
        while self.is_running:
            # ì¼ë°˜ ì œì–´ ëª…ë ¹
            cmd = self.uart.get_control_command(timeout=0.05)
            if cmd:
                command_data = cmd.get('command', {})
                self.cmd = [
                    command_data.get('vertical', 'level'),
                    command_data.get('horizontal', 'hover'),
                    command_data.get('rotation', 0),
                    command_data.get('speed', 0)
                ]
            
            # GPS ì´ë™ ëª…ë ¹
            gps_cmd = self.uart.get_gps_command(timeout=0.05)
            if gps_cmd:
                gps_data = gps_cmd.get('command', {})
                if 'altitude' in gps_data:
                    self.cmd = ["gps", gps_data['latitude'], 
                               gps_data['longitude'], gps_data['altitude']]
                else:
                    self.cmd = ["gps", gps_data['latitude'], 
                               gps_data['longitude']]
            
            await asyncio.sleep(0.01)
