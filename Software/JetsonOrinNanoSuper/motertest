import time
from pymavlink import mavutil

# 젯슨의 시리얼 포트(/dev/ttyTHS1)로 연결
master = mavutil.mavlink_connection('/dev/ttyTHS1', baud=921600)

# 연결 확인
print("Waiting for heartbeat...")
master.wait_heartbeat()
print("Heartbeat from system (system %u component %u)" % (master.target_system, master.target_component))

# --- 모터 1번 테스트 ---
print("Testing motor 1 for 3 seconds...")
master.mav.command_long_send(
    master.target_system,
    master.target_component,
    mavutil.mavlink.MAV_CMD_DO_MOTOR_TEST,
    0,  # confirmation
    0,  # Motor number (0=1, 1=2, ...) / ArduPilot에서는 1부터 시작
    mavutil.mavlink.MOTOR_TEST_THROTTLE_PERCENT, # Throttle type
    10, # Throttle value (5~10% 정도로 낮게 시작)
    3,  # Timeout (seconds)
    0,  # Motor count (0 for all)
    mavutil.mavlink.MOTOR_TEST_ORDER_BOARD, # Test order
    0)

# 테스트가 끝날 때까지 대기
time.sleep(4)

print("Motor test finished.")
